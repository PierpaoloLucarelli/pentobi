#pragma once
#include <vector>
#include <unordered_map>
#include <string>
#include <cstdint>

struct Block {
    char name;
    int width;
    int height;
    int size;
    std::vector<int> corners; 
    std::vector<std::vector<std::pair<int, int>>> coords;

    Block(char name, int size, int width, int height, const std::vector<std::vector<std::pair<int, int>>> & coords, const std::vector<int>& corners)
        : name(name), size(size), width(width), height(height), coords(coords), corners(corners){}
};

const Block rotatedPieces[21] = {
	Block('a', 1, 1, 1, {{{0, 0}},{{0, 0}},{{0, 0}},{{0, 0}},{{0, 0}},{{0, 0}},{{0, 0}},{{0, 0}}}, {0}),
	Block('b', 2, 1, 2, {{{0, 0},{0, 1}},{{0, 0},{-1, 0}},{{0, 0},{0, -1}},{{0, 0},{1, 0}},{{0, 0},{0, 1}},{{0, 0},{-1, 0}},{{0, 0},{0, -1}},{{0, 0},{1, 0}}}, {0,1}),
	Block('c', 3, 1, 3, {{{0, 0},{0, 1},{0, -1}},{{0, 0},{-1, 0},{1, 0}},{{0, 0},{0, -1},{0, 1}},{{0, 0},{1, 0},{-1, 0}},{{0, 0},{0, 1},{0, -1}},{{0, 0},{-1, 0},{1, 0}},{{0, 0},{0, -1},{0, 1}},{{0, 0},{1, 0},{-1, 0}}}, {1,2}),
	Block('d', 3, 2, 2, {{{0, 0},{1, 0},{0, -1}},{{0, 0},{0, 1},{1, 0}},{{0, 0},{-1, 0},{0, 1}},{{0, 0},{0, -1},{-1, 0}},{{0, 0},{-1, 0},{0, -1}},{{0, 0},{0, -1},{1, 0}},{{0, 0},{1, 0},{0, 1}},{{0, 0},{0, 1},{-1, 0}}}, {0,1,2}),
	Block('e', 4, 1, 4, {{{0, 0},{0, 1},{0, 2},{0, -1}},{{0, 0},{-1, 0},{-2, 0},{1, 0}},{{0, 0},{0, -1},{0, -2},{0, 1}},{{0, 0},{1, 0},{2, 0},{-1, 0}},{{0, 0},{0, 1},{0, 2},{0, -1}},{{0, 0},{-1, 0},{-2, 0},{1, 0}},{{0, 0},{0, -1},{0, -2},{0, 1}},{{0, 0},{1, 0},{2, 0},{-1, 0}}}, {2,3}),
	Block('f', 4, 2, 3, {{{0, 0},{0, -1},{0, 1},{-1, 1}},{{0, 0},{1, 0},{-1, 0},{-1, -1}},{{0, 0},{0, 1},{0, -1},{1, -1}},{{0, 0},{-1, 0},{1, 0},{1, 1}},{{0, 0},{0, -1},{0, 1},{1, 1}},{{0, 0},{1, 0},{-1, 0},{-1, 1}},{{0, 0},{0, 1},{0, -1},{-1, -1}},{{0, 0},{-1, 0},{1, 0},{1, -1}}}, {1,2,3}),
	Block('g', 4, 2, 3, {{{0, 0},{1, 0},{0, 1},{0, -1}},{{0, 0},{0, 1},{-1, 0},{1, 0}},{{0, 0},{-1, 0},{0, -1},{0, 1}},{{0, 0},{0, -1},{1, 0},{-1, 0}},{{0, 0},{-1, 0},{0, 1},{0, -1}},{{0, 0},{0, -1},{-1, 0},{1, 0}},{{0, 0},{1, 0},{0, -1},{0, 1}},{{0, 0},{0, 1},{1, 0},{-1, 0}}}, {1,2,3}),
	Block('h', 4, 2, 2, {{{0, 0},{1, 0},{0, 1},{1, 1}},{{0, 0},{0, 1},{-1, 0},{-1, 1}},{{0, 0},{-1, 0},{0, -1},{-1, -1}},{{0, 0},{0, -1},{1, 0},{1, -1}},{{0, 0},{-1, 0},{0, 1},{-1, 1}},{{0, 0},{0, -1},{-1, 0},{-1, -1}},{{0, 0},{1, 0},{0, -1},{1, -1}},{{0, 0},{0, 1},{1, 0},{1, 1}}}, {0,1,2,3}),
	Block('i', 4, 3, 2, {{{-1, 0},{0, 0},{0, 1},{1, 1}},{{0, -1},{0, 0},{-1, 0},{-1, 1}},{{1, 0},{0, 0},{0, -1},{-1, -1}},{{0, 1},{0, 0},{1, 0},{1, -1}},{{1, 0},{0, 0},{0, 1},{-1, 1}},{{0, 1},{0, 0},{-1, 0},{-1, -1}},{{-1, 0},{0, 0},{0, -1},{1, -1}},{{0, -1},{0, 0},{1, 0},{1, 1}}}, {0,1,2,3}),
	Block('j', 5, 1, 5, {{{0, 0},{0, 1},{0, 2},{0, -1},{0, -2}},{{0, 0},{-1, 0},{-2, 0},{1, 0},{2, 0}},{{0, 0},{0, -1},{0, -2},{0, 1},{0, 2}},{{0, 0},{1, 0},{2, 0},{-1, 0},{-2, 0}},{{0, 0},{0, 1},{0, 2},{0, -1},{0, -2}},{{0, 0},{-1, 0},{-2, 0},{1, 0},{2, 0}},{{0, 0},{0, -1},{0, -2},{0, 1},{0, 2}},{{0, 0},{1, 0},{2, 0},{-1, 0},{-2, 0}}}, {2,4}),
	Block('k', 5, 2, 4, {{{0, 0},{0, 1},{0, -2},{0, -1},{-1, 1}},{{0, 0},{-1, 0},{2, 0},{1, 0},{-1, -1}},{{0, 0},{0, -1},{0, 2},{0, 1},{1, -1}},{{0, 0},{1, 0},{-2, 0},{-1, 0},{1, 1}},{{0, 0},{0, 1},{0, -2},{0, -1},{1, 1}},{{0, 0},{-1, 0},{2, 0},{1, 0},{-1, 1}},{{0, 0},{0, -1},{0, 2},{0, 1},{-1, -1}},{{0, 0},{1, 0},{-2, 0},{-1, 0},{1, -1}}}, {1,2,4}),
	Block('l', 5, 2, 4, {{{0, -2},{0, -1},{0, 0},{-1, 0},{-1, 1}},{{2, 0},{1, 0},{0, 0},{0, -1},{-1, -1}},{{0, 2},{0, 1},{0, 0},{1, 0},{1, -1}},{{-2, 0},{-1, 0},{0, 0},{0, 1},{1, 1}},{{0, -2},{0, -1},{0, 0},{1, 0},{1, 1}},{{2, 0},{1, 0},{0, 0},{0, 1},{-1, 1}},{{0, 2},{0, 1},{0, 0},{-1, 0},{-1, -1}},{{-2, 0},{-1, 0},{0, 0},{0, -1},{1, -1}}}, {0,2,3,4}),
	Block('m', 5, 2, 3, {{{0, -1},{-1, 0},{0, 0},{-1, 1},{0, 1}},{{1, 0},{0, -1},{0, 0},{-1, -1},{-1, 0}},{{0, 1},{1, 0},{0, 0},{1, -1},{0, -1}},{{-1, 0},{0, 1},{0, 0},{1, 1},{1, 0}},{{0, -1},{1, 0},{0, 0},{1, 1},{0, 1}},{{1, 0},{0, 1},{0, 0},{-1, 1},{-1, 0}},{{0, 1},{-1, 0},{0, 0},{-1, -1},{0, -1}},{{-1, 0},{0, -1},{0, 0},{1, -1},{1, 0}}}, {0,1,3,4}),
	Block('n', 5, 2, 3, {{{0, 0},{0, 1},{-1, 1},{0, -1},{-1, -1}},{{0, 0},{-1, 0},{-1, -1},{1, 0},{1, -1}},{{0, 0},{0, -1},{1, -1},{0, 1},{1, 1}},{{0, 0},{1, 0},{1, 1},{-1, 0},{-1, 1}},{{0, 0},{0, 1},{1, 1},{0, -1},{1, -1}},{{0, 0},{-1, 0},{-1, 1},{1, 0},{1, 1}},{{0, 0},{0, -1},{-1, -1},{0, 1},{-1, 1}},{{0, 0},{1, 0},{1, -1},{-1, 0},{-1, -1}}}, {1,2,3,4}),
	Block('o', 5, 2, 4, {{{0, -1},{0, 0},{1, 0},{0, 1},{0, 2}},{{1, 0},{0, 0},{0, 1},{-1, 0},{-2, 0}},{{0, 1},{0, 0},{-1, 0},{0, -1},{0, -2}},{{-1, 0},{0, 0},{0, -1},{1, 0},{2, 0}},{{0, -1},{0, 0},{-1, 0},{0, 1},{0, 2}},{{1, 0},{0, 0},{0, -1},{-1, 0},{-2, 0}},{{0, 1},{0, 0},{1, 0},{0, -1},{0, -2}},{{-1, 0},{0, 0},{0, 1},{1, 0},{2, 0}}}, {0,2,4}),
	Block('p', 5, 3, 3, {{{0, 0},{0, -1},{0, 1},{-1, 1},{1, 1}},{{0, 0},{1, 0},{-1, 0},{-1, -1},{-1, 1}},{{0, 0},{0, 1},{0, -1},{1, -1},{-1, -1}},{{0, 0},{-1, 0},{1, 0},{1, 1},{1, -1}},{{0, 0},{0, -1},{0, 1},{1, 1},{-1, 1}},{{0, 0},{1, 0},{-1, 0},{-1, 1},{-1, -1}},{{0, 0},{0, 1},{0, -1},{-1, -1},{1, -1}},{{0, 0},{-1, 0},{1, 0},{1, -1},{1, 1}}}, {1,3,4}),
	Block('q', 5, 3, 3, {{{0, 0},{1, 0},{2, 0},{0, -1},{0, -2}},{{0, 0},{0, 1},{0, 2},{1, 0},{2, 0}},{{0, 0},{-1, 0},{-2, 0},{0, 1},{0, 2}},{{0, 0},{0, -1},{0, -2},{-1, 0},{-2, 0}},{{0, 0},{-1, 0},{-2, 0},{0, -1},{0, -2}},{{0, 0},{0, -1},{0, -2},{1, 0},{2, 0}},{{0, 0},{1, 0},{2, 0},{0, 1},{0, 2}},{{0, 0},{0, 1},{0, 2},{-1, 0},{-2, 0}}}, {0,2,4}),
	Block('r', 5, 3, 3, {{{0, 0},{1, 0},{1, 1},{0, -1},{-1, -1}},{{0, 0},{0, 1},{-1, 1},{1, 0},{1, -1}},{{0, 0},{-1, 0},{-1, -1},{0, 1},{1, 1}},{{0, 0},{0, -1},{1, -1},{-1, 0},{-1, 1}},{{0, 0},{-1, 0},{-1, 1},{0, -1},{1, -1}},{{0, 0},{0, -1},{-1, -1},{1, 0},{1, 1}},{{0, 0},{1, 0},{1, -1},{0, 1},{-1, 1}},{{0, 0},{0, 1},{1, 1},{-1, 0},{-1, -1}}}, {0,1,2,3,4}),
	Block('s', 5, 3, 3, {{{0, 0},{1, 0},{1, 1},{-1, 0},{-1, -1}},{{0, 0},{0, 1},{-1, 1},{0, -1},{1, -1}},{{0, 0},{-1, 0},{-1, -1},{1, 0},{1, 1}},{{0, 0},{0, -1},{1, -1},{0, 1},{-1, 1}},{{0, 0},{-1, 0},{-1, 1},{1, 0},{1, -1}},{{0, 0},{0, -1},{-1, -1},{0, 1},{1, 1}},{{0, 0},{1, 0},{1, -1},{-1, 0},{-1, 1}},{{0, 0},{0, 1},{1, 1},{0, -1},{-1, -1}}}, {1,2,3,4}),
	Block('t', 5, 3, 3, {{{-1, -1},{-1, 0},{0, 0},{1, 0},{0, 1}},{{1, -1},{0, -1},{0, 0},{0, 1},{-1, 0}},{{1, 1},{1, 0},{0, 0},{-1, 0},{0, -1}},{{-1, 1},{0, 1},{0, 0},{0, -1},{1, 0}},{{1, -1},{1, 0},{0, 0},{-1, 0},{0, 1}},{{1, 1},{0, 1},{0, 0},{0, -1},{-1, 0}},{{-1, 1},{-1, 0},{0, 0},{1, 0},{0, -1}},{{-1, -1},{0, -1},{0, 0},{0, 1},{1, 0}}}, {0,1,3,4}),
	Block('u', 5, 3, 3, {{{0, 0},{1, 0},{0, 1},{-1, 0},{0, -1}},{{0, 0},{0, 1},{-1, 0},{0, -1},{1, 0}},{{0, 0},{-1, 0},{0, -1},{1, 0},{0, 1}},{{0, 0},{0, -1},{1, 0},{0, 1},{-1, 0}},{{0, 0},{-1, 0},{0, 1},{1, 0},{0, -1}},{{0, 0},{0, -1},{-1, 0},{0, 1},{1, 0}},{{0, 0},{1, 0},{0, -1},{-1, 0},{0, 1}},{{0, 0},{0, 1},{1, 0},{0, -1},{-1, 0}}}, {1,2,3,4})
};

std::unordered_map<std::string, int> pieceMap = {
  {"I1", 0},
  {"I2", 1},
  {"I3", 2},
  {"V3", 3},
  {"I4", 4},
  {"L4", 5},
  {"T4", 6},
  {"O4", 7},
  {"Z4", 8},
  {"I5", 9},
  {"L5", 10},
  {"N", 11},
  {"P", 12},
  {"U", 13},
  {"Y", 14},
  {"T", 15},
  {"V5", 16},
  {"W", 17},
  {"Z5", 18},
  {"F", 19},
  {"X", 20},
};

struct TurnBaseMove{
  uint8_t pieceId;
  uint8_t row;
  uint8_t col;
  uint8_t rotation;
};

std::vector<TurnBaseMove> generateMap();

TurnBaseMove findMove(std::vector<int> board, std::vector<std::pair<int, int>> coords);

std::vector<int> applyMove(int row, int col, std::vector<std::pair<int, int>> coords);
